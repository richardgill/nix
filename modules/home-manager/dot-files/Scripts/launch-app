#!/usr/bin/env bash
set -euo pipefail

workspace="$1"

hyprctl dispatch workspace "$workspace"

if [[ "$workspace" == "10" ]]; then
  if ! pgrep -f '^[^ ]*ghostty$' > /dev/null; then
    uwsm app -- ~/Scripts/launch-ghostty
  fi
elif [[ "$workspace" == "11" ]]; then
  if ! pgrep nautilus > /dev/null; then
    uwsm app -- nautilus --new-window &
  fi
elif [[ "$workspace" == "12" ]]; then
  if ! pgrep "firefox" > /dev/null; then
    uwsm app -- firefox &
  fi
elif [[ "$workspace" == "13" ]]; then
  if ! pgrep -f 'ghostty.*btop' > /dev/null; then
    ~/Scripts/launch-terminal-app btop &
  fi
elif [[ "$workspace" == "14" ]]; then
  if ! pgrep -x discord > /dev/null; then
    uwsm app -- discord &
  fi
elif [[ "$workspace" == "15" ]]; then
  if ! pgrep -x 1password > /dev/null; then
    uwsm app -- 1password &
  fi
elif [[ "$workspace" == "16" ]]; then
  if ! hyprctl clients -j | jq -e '.[] | select(.class == "Slack")' > /dev/null; then
    uwsm app -- slack &
    sleep 3
  fi
  address=$(hyprctl activewindow -j | jq -r '.address')
  ~/Scripts/delay-app 15 "$address" $((60 * 3)) &
elif [[ "$workspace" == "17" ]]; then
  if ! pgrep -x beeper > /dev/null; then
    uwsm app -- beeper &
  fi
elif [[ "$workspace" == "18" ]]; then
  if ! hyprctl clients -j | jq -e '.[] | select(.class == "spotify" or .title == "cmus")' > /dev/null; then
    ~/Scripts/launch-terminal-app cmus &
  fi
elif [[ "$workspace" == "19" ]]; then
  if ! ~/Scripts/check-webapp-open zoom; then
    omarchy-launch-webapp "https://app.zoom.us/wc/home" &
  fi
elif [[ "$workspace" == "20" ]]; then
  if ! hyprctl clients -j | jq -e '.[] | select(.class == "Todoist")' > /dev/null; then
    uwsm app -- todoist-electron &
  fi
elif [[ "$workspace" == "21" ]]; then
  if ! hyprctl clients -j | jq -e '.[] | select(.class | test("google-chrome|chromium|Chromium"))' > /dev/null; then
    uwsm app -- google-chrome-stable &
  fi
fi

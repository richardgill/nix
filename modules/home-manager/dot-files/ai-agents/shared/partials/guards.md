Check invariants with guards at the top of functions; return or throw if they fail.

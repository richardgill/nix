#!/usr/bin/env bash
set -euo pipefail

gmcli_bin=$(mise which gmcli)
op_vault="${OP_GMAIL_CREDENTIALS_VAULT:-Private}"
op_document="${OP_GMAIL_CREDENTIALS_DOCUMENT:-gsuite-credentials.json}"
credentials_path="${HOME}/.gmcli/credentials.json"

if [[ ! -f "$credentials_path" ]]; then
  "$gmcli_bin" accounts credentials <(op document get "$op_document" --vault "$op_vault") >/dev/null
fi

exec "$gmcli_bin" "$@"
